!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("vue"),require("@blazes/utils"),require("@blazes/theme"),require("@ant-design/icons-vue"),require("vue-router"),require("ant-design-vue/lib/message"));else if("function"==typeof define&&define.amd)define([,"@blazes/utils","@blazes/theme","@ant-design/icons-vue","vue-router","ant-design-vue/lib/message"],t);else{var o="object"==typeof exports?t(require("vue"),require("@blazes/utils"),require("@blazes/theme"),require("@ant-design/icons-vue"),require("vue-router"),require("ant-design-vue/lib/message")):t(e.Vue,e["@blazes/utils"],e["@blazes/theme"],e["@ant-design/icons-vue"],e["vue-router"],e["ant-design-vue/lib/message"]);for(var r in o)("object"==typeof exports?exports:e)[r]=o[r]}}(window,(function(e,t,o,r,n,l){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=28)}([function(t,o){t.exports=e},function(e,o){e.exports=t},function(e,t){e.exports=o},function(e,t){e.exports=r},function(e,t,o){"use strict";var r=o(0);const n=Object(r.withScopeId)("data-v-2f86d144");Object(r.pushScopeId)("data-v-2f86d144");const l={ref:"wrapperRef"},c={key:0},i={class:"ellipsis"};Object(r.popScopeId)();const a=n((e,t,o,a,s,u)=>{const d=Object(r.resolveComponent)("a-popover");return Object(r.openBlock)(),Object(r.createBlock)("div",l,["normal"===e.mode?(Object(r.openBlock)(),Object(r.createBlock)("div",c,Object(r.toDisplayString)(e.text),1)):(Object(r.openBlock)(),Object(r.createBlock)(d,{key:1,placement:"top",width:400,content:e.relTooltip,trigger:"hover",overlayClassName:e.popperClass},{default:n(()=>[Object(r.createVNode)("div",i,Object(r.toDisplayString)(e.text),1),Object(r.renderSlot)(e.$slots,"content",{},()=>[Object(r.createVNode)("div",null,Object(r.toDisplayString)(e.relTooltip),1)],{},!0)]),_:3},8,["content","overlayClassName"]))],512)});var s=o(1),u=Object(r.defineComponent)({name:"ellipsis",props:{text:String,toolTip:String,popperClass:{type:String,default:""}},setup(e){const t=e.toolTip||e.text,o=Object(r.ref)("normal"),n=Object(r.ref)(null);return Object(r.onMounted)(()=>{setTimeout(()=>{const e=n.value,{lineHeight:t,height:r}=getComputedStyle(e);Math.abs(Object(s.toNum)(t)-Object(s.toNum)(r))>1&&(o.value="ellipsis")},100)}),{mode:o,relTooltip:t,wrapperRef:n}}});o(9);u.render=a,u.__scopeId="data-v-2f86d144";t.a=u},function(e,t,o){},function(e,t){e.exports=n},,,function(e,t,o){"use strict";o(5)},,,,,,function(e,t,o){},function(e,t,o){},,,function(e,t){e.exports=l},,,,function(e,t,o){"use strict";o(15)},function(e,t,o){"use strict";o(16)},,,,function(e,t,o){"use strict";o.r(t);var r=o(0);const n=Object(r.withScopeId)("data-v-b73725d6");Object(r.pushScopeId)("data-v-b73725d6");const l={class:"st"},c={class:"header"},i={class:"st-filter-menu"},a={class:"st-filter-menu fx-jb fx-ac"},s=Object(r.createTextVNode)("全选"),u={class:"st-filter-menu"},d=Object(r.createTextVNode)(" 加载中"),p={class:"icon-xs"};Object(r.popScopeId)();const b=n((e,t,o,b,f,O)=>{const v=Object(r.resolveComponent)("FilterOutlined"),j=Object(r.resolveComponent)("a-checkbox"),m=Object(r.resolveComponent)("a-menu-item"),h=Object(r.resolveComponent)("a-button"),k=Object(r.resolveComponent)("LoadingOutlined"),g=Object(r.resolveComponent)("a-menu"),y=Object(r.resolveComponent)("a-dropdown"),x=Object(r.resolveComponent)("a-tag"),C=Object(r.resolveComponent)("Ellipsis"),B=Object(r.resolveComponent)("DownOutlined"),_=Object(r.resolveComponent)("a-popconfirm"),w=Object(r.resolveComponent)("a-table-column"),N=Object(r.resolveComponent)("a-table");return Object(r.openBlock)(),Object(r.createBlock)("div",l,[Object(r.createVNode)(N,{onChange:e.changeTable,"data-source":e.data$,loading:e.loading,pagination:!!e.isPagination&&{current:e.pi$,pageSize:e.ps$,total:e.total$,"show-total":e.showTotal},rowKey:e.rowKey,scroll:e.scroll,bordered:e.bordered},Object(r.createSlots)({default:n(()=>[(Object(r.openBlock)(!0),Object(r.createBlock)(r.Fragment,null,Object(r.renderList)(e.columns$,(t,o)=>(Object(r.openBlock)(),Object(r.createBlock)(w,{width:t.width,key:t.index+t.render+t.title+t.renderTitle,customRender:t.customRender,fixed:t.fixed||!1,sorter:t.sorter,ellipsis:t.ellipsis},{title:n(l=>[Object(r.createVNode)("div",c,[t.renderTitle?Object(r.renderSlot)(e.$slots,t.renderTitle,{key:0,row:l.row,title:t.title},void 0,!0):(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:1},[Object(r.createTextVNode)(Object(r.toDisplayString)(t.title),1)],2112)),t.filter?(Object(r.openBlock)(),Object(r.createBlock)(y,{key:2,class:"filter",ref:e.setDropdownRef(o),overlayClassName:"st-dropdown-filter",visible:t.filter._visible.value,"onUpdate:visible":e=>t.filter._visible.value=e,trigger:["click"]},{overlay:n(()=>[Object(r.createVNode)(g,null,{default:n(()=>[t.filter._menus.value.length?(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:0},[(Object(r.openBlock)(!0),Object(r.createBlock)(r.Fragment,null,Object(r.renderList)(t.filter._menus.value,l=>(Object(r.openBlock)(),Object(r.createBlock)(m,{key:l.value},{default:n(()=>[Object(r.createVNode)("div",i,[Object(r.createVNode)(j,{checked:l.checked,"onUpdate:checked":e=>l.checked=e,onChange:r=>e.handleCheckPart(t,o)},{default:n(()=>[Object(r.createTextVNode)(Object(r.toDisplayString)(l.text),1)]),_:2},1032,["checked","onUpdate:checked","onChange"])])]),_:2},1024))),128)),Object(r.createVNode)(m,{class:"footer",divided:""},{default:n(()=>[Object(r.createVNode)("div",a,[Object(r.createVNode)(j,{indeterminate:t.filter.indeterminate.value,checked:t.filter.checkAll.value,"onUpdate:checked":e=>t.filter.checkAll.value=e,onChange:r=>e.handleCheckAll(r,t,o)},{default:n(()=>[s]),_:2},1032,["indeterminate","checked","onUpdate:checked","onChange"]),Object(r.createVNode)(h,{size:"small",type:"primary",onClick:r=>e.filterConfirm(t,o)},{default:n(()=>[Object(r.createTextVNode)(Object(r.toDisplayString)(t.filter.confirmText),1)]),_:2},1032,["onClick"])])]),_:2},1024)],64)):(Object(r.openBlock)(),Object(r.createBlock)(m,{key:1},{default:n(()=>[Object(r.createVNode)("div",u,[d,Object(r.createVNode)(k)])]),_:1}))]),_:2},1024)]),default:n(()=>[Object(r.createVNode)(v,{class:["point",{active:t.filter._default.value}],onClick:Object(r.withModifiers)(e=>t.filter._visible.value=!0,["self"])},null,8,["class","onClick"])]),_:2},1032,["visible","onUpdate:visible"])):Object(r.createCommentVNode)("v-if",!0)])]),default:n(({record:l})=>[t.render?Object(r.renderSlot)(e.$slots,t.render,{key:0,row:l,value:l._values[o]},void 0,!0):(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:1},[l._values[o].text?(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:0},["tag"===t.type?(Object(r.openBlock)(),Object(r.createBlock)(x,{key:0,color:l._values[o].color},{default:n(()=>[Object(r.createTextVNode)(Object(r.toDisplayString)(l._values[o].text),1)]),_:2},1032,["color"])):"ellipsis"===t.type?(Object(r.openBlock)(),Object(r.createBlock)(C,{key:1,text:l._values[o].text},null,8,["text"])):"link"===t.type?(Object(r.openBlock)(),Object(r.createBlock)("a",{key:2,onClick:Object(r.withModifiers)(o=>e.click(l,t),["stop","prevent"])},Object(r.toDisplayString)(l._values[o].text),9,["onClick"])):Object(r.createCommentVNode)("v-if",!0),Object(r.createVNode)("span",{title:t.ellipsis?l._values[o].text:""},Object(r.toDisplayString)(l._values[o].text),9,["title"])],64)):Object(r.createCommentVNode)("v-if",!0),(Object(r.openBlock)(!0),Object(r.createBlock)(r.Fragment,null,Object(r.renderList)(e.validBtns(t.buttons,l,t),o=>(Object(r.openBlock)(),Object(r.createBlock)("span",{key:o.text,class:"mr-md btn"},[o.children.length>0?(Object(r.openBlock)(),Object(r.createBlock)(y,{key:0},{overlay:n(()=>[Object(r.createVNode)(g,null,{default:n(()=>[(Object(r.openBlock)(!0),Object(r.createBlock)(r.Fragment,null,Object(r.renderList)(e.validBtns(o.children,l,t),t=>(Object(r.openBlock)(),Object(r.createBlock)(m,{key:t.text,onClick:o=>e.btnClick(l,t)},{default:n(()=>[Object(r.createVNode)("span",{innerHTML:e.btnText(l._values,t)},null,8,["innerHTML"]),(Object(r.openBlock)(),Object(r.createBlock)(Object(r.resolveDynamicComponent)(t.icon)))]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),default:n(()=>[Object(r.createVNode)("span",p,[Object(r.createVNode)("a",null,[Object(r.createVNode)("span",{innerHTML:e.btnText(l._values,o)},null,8,["innerHTML"]),Object(r.createVNode)(B)])])]),_:2},1024)):(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:1},["popconfirm"===o.type?(Object(r.openBlock)(),Object(r.createBlock)(_,{key:0,title:o.popconfirm.title,onConfirm:e=>o.popconfirm.confirm(l)},{default:n(()=>[Object(r.createVNode)("a",null,[Object(r.createVNode)("span",{innerHTML:e.btnText(l._values,o)},null,8,["innerHTML"]),(Object(r.openBlock)(),Object(r.createBlock)(Object(r.resolveDynamicComponent)(o.icon)))])]),_:2},1032,["title","onConfirm"])):(Object(r.openBlock)(),Object(r.createBlock)("a",{key:1,onClick:t=>e.btnClick(l,o)},[Object(r.createVNode)("span",{innerHTML:e.btnText(l._values,o)},null,8,["innerHTML"]),(Object(r.openBlock)(),Object(r.createBlock)(Object(r.resolveDynamicComponent)(o.icon)))],8,["onClick"]))],2112))]))),128))],64))]),_:2},1032,["width","customRender","fixed","sorter","ellipsis"]))),128))]),_:2},[e.$slots.expandedRowRender?{name:"expandedRowRender",fn:n(({record:t})=>[Object(r.renderSlot)(e.$slots,"expandedRowRender",{record:t},void 0,!0)])}:void 0]),1032,["onChange","data-source","loading","pagination","rowKey","scroll","bordered"])])});var f=o(1);const O={reName:{total:"total",list:"items"}},v={reName:{pi:"offset",ps:"limit"}},j={front:!0,position:"bottom",show:!0,showSize:!1,pageSizes:[10,20,30,40,50],showQuickJumper:!1,indexReset:!0,toTop:!0,toTopOffset:100},m="确定",h="重置";class k{constructor(){this.lastColumns=[]}process(e){if(this.lastColumns=e,f.ArrayService.arrIsEmpty(e))throw new Error("[st]: the columns property muse be define!");const t=[],o=Object(f.deepCopy)(e);for(const e of o)e.iif&&e.iif(e)||(e.index&&(Array.isArray(e.index)||(e.index=e.index.split(".")),e.indexKey=e.index.join(".")),e.buttons=this.fixButtons(e.buttons),e.width=e.width||"auto",e.default=e.default||"",e.filter=this.filterCoerce(e),t.push(e));return this.fixedCoerce(t),t}filterCoerce(e){if(null==e.filter)return null;const t=e.filter;if((null==t||!t.menus)&&f.ArrayService.arrIsEmpty(null==t?void 0:t.menus))return null;t._menus=Object(r.reactive)({value:[]});return(Array.isArray(t.menus)?()=>Promise.resolve(t.menus):t.menus)().then(e=>{t._menus.value=e}),t.confirmText=t.confirmText||m,t.clearText=t.clearText||h,t.key=t.key||e.indexKey,t._default=Object(r.reactive)({value:!1}),t.indeterminate=Object(r.reactive)({value:!1}),t.checkAll=Object(r.reactive)({value:!1}),t._visible=Object(r.reactive)({value:!1}),t}fixedCoerce(e){const t=(e,t)=>e+ +t.width.toString().replace("px","");e.filter(e=>e.fixed&&"left"===e.fixed&&e.width).forEach((o,r)=>o._left=e.slice(0,r).reduce(t,0)+"px"),e.filter(e=>e.fixed&&"right"===e.fixed&&e.width).reverse().forEach((o,r)=>o._right=(r>0?e.slice(-r).reduce(t,0):0)+"px")}fixButtons(e){if(!e)return[];const t=[];for(const o of e)o.children=f.ArrayService.arrIsEmpty(o.children)?[]:this.fixButtons(o.children),t.push(o);return this.btnCoerceIf(t),t}btnCoerceIf(e){for(const t of e)t.iif||(t.iif=()=>!0),t.iifBehavior=t.iifBehavior||"hide",t.children&&t.children.length>0?this.btnCoerceIf(t.children):t.children=[]}cleanFilter(e){e.filter._menus.value.forEach(e=>e.checked=!1)}checkAllFilter(e,t){t.filter._menus.value.forEach(t=>t.checked=e)}updateDefault(e){e._default.value=-1!==e._menus.value.findIndex(e=>e.checked)}updateIndeterminate(e){const t=e._menus,o=t.value.filter(e=>e.checked).length;e.indeterminate.value=o>0&&o!==t.value.length,e.checkAll.value=o===t.value.length}}var g=o(2);class y{process(e){return new Promise((t,o)=>{const{data:r,res:n,paginator:l,page:c,ps:i,pi:a,columns:s,total:u}=e;let d,p,b,O,v,j=!1,m=c.show;"string"==typeof r?(j=!0,d=this.getByHttp(r,e).then(e=>{let t;var o,r;(v=e,Array.isArray(e))?(t=e,p=t.length,b=p,m=!1):(t=Object(f.deepGet)(e,null==n||null===(o=n.reName)||void 0===o?void 0:o.list,[]),Array.isArray(t)||(t=[]),p=+Object(f.deepGet)(e,null==n||null===(r=n.reName)||void 0===r?void 0:r.total,[])||0);return Object(f.deepCopy)(t)}).catch(e=>(o(e),[]))):d=Array.isArray(r)?Promise.resolve(r):r,j||(d=d.then(e=>(s.filter(e=>e.filter).forEach(t=>{const o=t.filter,r=this.getFilteredData(o);if(0===r.length)return;const n=o.fn;"function"==typeof n?e=e.filter(e=>r.some(t=>n(t,e))):console.warn("[st] Muse provide the fn function in filter")}),e)).then(e=>{if(v=e,l&&c.front){const t=Math.ceil(e.length/i);if(O=Math.max(1,a>t?t:a),p=e.length,c.show)return e.slice((O-1)*i,O*i)}return e})),"function"==typeof n.process&&(d=d.then(e=>n.process(e,v))),d=d.then(e=>{const t=((O||a)-1)*(b||i);for(let o=0,r=e.length;o<r;o++){const r=t+o+1;e[o]._values=s.map((t,n)=>this.get(e[o],t,n,r))}return e}),d.then(e=>{t({pi:O,ps:b,total:p,list:e,pageShow:void 0===m?(p||u)>(b||i):m})})})}get(e,t,o,r){if(t.format){const n=t.format(e,t,o,r);return{text:n||"",org:n}}const n=Object(f.deepGet)(e,t.index,t.default);let l,c=n;switch(t.type){case"tag":{const e=t.tag;if(e&&e[c]){const t=e[c];c=t.text,l=t.color}else c="";break}}return{text:null!=c?c:"",org:n,color:l}}getByHttp(e,t){const{req:o,paginator:r,pi:n,ps:l,columns:c,first:i}=t;let a={};const s=o.reName;return r&&(a={[null==s?void 0:s.pi]:n,[null==s?void 0:s.ps]:l}),a={...a,...o.params,...this.getReqFilterMap(c),...i&&o.firstParams?o.firstParams:{}},g.instance.get(e,{params:a,headers:o.headers})}getFilteredData(e){return e._menus.value.filter(e=>!0===e.checked)}getReqFilterMap(e){let t={};return e.filter(e=>e.filter).forEach(e=>{const o=e.filter,r=this.getFilteredData(o);let n={};o.reName?n=o.reName(o._menus.value,e):n[o.key]=r.map(e=>e.value).join(","),t={...t,...n}}),t}}var x=o(4),C=o(3),B=o(19),_=o.n(B),w=o(6),N=Object(r.defineComponent)({name:"st",props:{columns:Array,pageVo:Object,data:[String,Array,Object],pi:Number,ps:Number,total:Number,res:Object,req:Object,page:Object,rowKey:String,scroll:Object,pagination:{type:Boolean,default:!0},bordered:Boolean},components:{Ellipsis:x.a,LoadingOutlined:C.LoadingOutlined,DownOutlined:C.DownOutlined,EditOutlined:C.EditOutlined,DeleteOutlined:C.DeleteOutlined,FilterOutlined:C.FilterOutlined},setup(e){const t=new k,o=new y,n=Object(r.ref)(!1),l=Object(r.ref)([]),c=Object(r.computed)(()=>Object(f.deepMerge)(e.req||{},v)),i=Object(r.computed)(()=>Object(f.deepMerge)(e.res||{},O)),a=Object(r.computed)(()=>Object(f.deepMerge)(e.res||{},j)),s=Object(r.ref)(e.pi||1),u=Object(r.ref)(e.ps||10),d=Object(r.ref)(e.total||0),p=Object(r.ref)(e.pagination),b=Object(r.ref)([]),[m,h]=Object(f.useRefs)(),g=Object(w.useRouter)(),x=(t=!1)=>{n.value=!0,o.process({pi:s.value,ps:u.value,total:d.value,data:e.data,req:c.value,res:i.value,page:a.value,paginator:!0,columns:l.value,first:t}).then(t=>{n.value=!1,void 0!==t.pi&&(s.value=t.pi),void 0!==t.ps&&(u.value=t.ps),void 0!==t.total&&(d.value=t.total),void 0!==t.pageShow&&e.pagination&&(p.value=t.pageShow),b.value=t.list}).catch(e=>{_.a.error("加载列表失败："+e)})},C=(e,t,o)=>{s.value=e,void 0!==t&&(c.value.params=o&&o.merge?{...c.value.params,...t}:t),x()},B=(e,t)=>{C(1,e,t)},N=e=>{l.value=t.process(e)};Object(r.onMounted)(()=>{N(e.columns),e.data&&x(!0)});const{data:S}=Object(r.toRefs)(e);Object(r.watch)(S,()=>{x()});return{loading:n,columns$:l,data$:b,isPagination:p,total$:d,pi$:s,ps$:u,btnText:(e,t)=>"function"==typeof t.text?t.text(e,t):t.text||"",validBtns:(e,t,o)=>e.filter(e=>{const r=e.iif(t,o),n="disabled"===e.iifBehavior;return e._result=r,e._disabled=!r&&n,r||n}),btnClick:(e,t)=>{if(!t.click)return;"reload"===t.click(e)&&B()},load:C,reload:B,handleCheckAll:(e,o,r)=>{t.checkAllFilter(e.target.checked,o),t.updateIndeterminate(o.filter)},filterConfirm:(e,o)=>{((e,o)=>{e.filter._visible.value=!1,s.value=1,t.updateDefault(e.filter),t.updateIndeterminate(e.filter),x()})(e)},setDropdownRef:h,resetColumns:t=>{void 0!==(t={emitReload:!0,preClearData:!1,...t}).pi&&(s.value=t.pi),void 0!==t.ps&&(u.value=t.ps),t.emitReload&&(t.preClearData=!0),t.preClearData&&(b.value=[]),N(t.columns||e.columns),t.emitReload&&x()},click:(e,t)=>{const o=t.click(e);"string"==typeof o&&g.push(o)},handleCheckPart:(e,o)=>{t.updateIndeterminate(e.filter)},changeTable:e=>{null!=e.current&&C(e.current)},showTotal:e=>`共${e}条`,reloadCurrent:()=>{C(s.value)}}}});o(23),o(24);N.render=b,N.__scopeId="data-v-b73725d6";var S=N;S.install=e=>{e.component(S.name,S)};const T=S;t.default=T}])}));
//# sourceMappingURL=index.js.map