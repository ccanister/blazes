!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("vue"),require("@blazes/utils"),require("@blazes/theme"),require("@ant-design/icons-vue"),require("vue-router"),require("ant-design-vue/lib/message"));else if("function"==typeof define&&define.amd)define([,"@blazes/utils","@blazes/theme","@ant-design/icons-vue","vue-router","ant-design-vue/lib/message"],t);else{var o="object"==typeof exports?t(require("vue"),require("@blazes/utils"),require("@blazes/theme"),require("@ant-design/icons-vue"),require("vue-router"),require("ant-design-vue/lib/message")):t(e.Vue,e["@blazes/utils"],e["@blazes/theme"],e["@ant-design/icons-vue"],e["vue-router"],e["ant-design-vue/lib/message"]);for(var r in o)("object"==typeof exports?exports:e)[r]=o[r]}}(window,(function(e,t,o,r,n,c){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=28)}([function(t,o){t.exports=e},function(e,o){e.exports=t},function(e,t){e.exports=o},function(e,t){e.exports=r},function(e,t,o){"use strict";var r=o(0);const n=Object(r.withScopeId)("data-v-2f86d144");Object(r.pushScopeId)("data-v-2f86d144");const c={ref:"wrapperRef"},l={key:0},a={class:"ellipsis"};Object(r.popScopeId)();const i=n((e,t,o,i,s,u)=>{const d=Object(r.resolveComponent)("a-popover");return Object(r.openBlock)(),Object(r.createBlock)("div",c,["normal"===e.mode?(Object(r.openBlock)(),Object(r.createBlock)("div",l,Object(r.toDisplayString)(e.text),1)):(Object(r.openBlock)(),Object(r.createBlock)(d,{key:1,placement:"top",width:400,content:e.relTooltip,trigger:"hover",overlayClassName:e.popperClass},{default:n(()=>[Object(r.createVNode)("div",a,Object(r.toDisplayString)(e.text),1),Object(r.renderSlot)(e.$slots,"content",{},()=>[Object(r.createVNode)("div",null,Object(r.toDisplayString)(e.relTooltip),1)],{},!0)]),_:3},8,["content","overlayClassName"]))],512)});var s=o(1),u=Object(r.defineComponent)({name:"ellipsis",props:{text:String,toolTip:String,popperClass:{type:String,default:""}},setup(e){const t=e.toolTip||e.text,o=Object(r.ref)("normal"),n=Object(r.ref)(null);return Object(r.onMounted)(()=>{setTimeout(()=>{const e=n.value,{lineHeight:t,height:r}=getComputedStyle(e);Math.abs(Object(s.toNum)(t)-Object(s.toNum)(r))>1&&(o.value="ellipsis")},100)}),{mode:o,relTooltip:t,wrapperRef:n}}});o(9);u.render=i,u.__scopeId="data-v-2f86d144";t.a=u},function(e,t,o){},function(e,t){e.exports=n},,,function(e,t,o){"use strict";o(5)},,,,,,function(e,t,o){},function(e,t,o){},,,function(e,t){e.exports=c},,,,function(e,t,o){"use strict";o(15)},function(e,t,o){"use strict";o(16)},,,,function(e,t,o){"use strict";o.r(t);var r=o(0);const n=Object(r.withScopeId)("data-v-5894e00e");Object(r.pushScopeId)("data-v-5894e00e");const c={class:"st"},l={class:"header"},a={class:"st-filter-menu"},i={class:"st-filter-menu fx-jb fx-ac"},s=Object(r.createTextVNode)("全选"),u={class:"st-filter-menu"},d=Object(r.createTextVNode)(" 加载中"),p={key:3},b={class:"icon-xs"};Object(r.popScopeId)();const f=n((e,t,o,f,O,v)=>{const j=Object(r.resolveComponent)("FilterOutlined"),m=Object(r.resolveComponent)("a-checkbox"),h=Object(r.resolveComponent)("a-menu-item"),k=Object(r.resolveComponent)("a-button"),g=Object(r.resolveComponent)("LoadingOutlined"),y=Object(r.resolveComponent)("a-menu"),x=Object(r.resolveComponent)("a-dropdown"),B=Object(r.resolveComponent)("a-tag"),C=Object(r.resolveComponent)("Ellipsis"),_=Object(r.resolveComponent)("DownOutlined"),w=Object(r.resolveComponent)("a-popconfirm"),N=Object(r.resolveComponent)("a-table-column"),S=Object(r.resolveComponent)("a-table");return Object(r.openBlock)(),Object(r.createBlock)("div",c,[Object(r.createVNode)(S,{onChange:e.changeTable,"data-source":e.data$,loading:e.loading,pagination:!!e.isPagination&&{current:e.pi$,pageSize:e.ps$,total:e.total$,"show-total":e.showTotal},rowKey:e.rowKey,scroll:e.scroll,bordered:e.bordered},Object(r.createSlots)({default:n(()=>[(Object(r.openBlock)(!0),Object(r.createBlock)(r.Fragment,null,Object(r.renderList)(e.columns$,(t,o)=>(Object(r.openBlock)(),Object(r.createBlock)(N,{width:t.width,key:t.index+t.render+t.title+t.renderTitle,customRender:t.customRender,fixed:t.fixed||!1,sorter:t.sorter},{title:n(c=>[Object(r.createVNode)("div",l,[t.renderTitle?Object(r.renderSlot)(e.$slots,t.renderTitle,{key:0,row:c.row,title:t.title},void 0,!0):(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:1},[Object(r.createTextVNode)(Object(r.toDisplayString)(t.title),1)],2112)),t.filter?(Object(r.openBlock)(),Object(r.createBlock)(x,{key:2,class:"filter",ref:e.setDropdownRef(o),overlayClassName:"st-dropdown-filter",visible:t.filter._visible.value,"onUpdate:visible":e=>t.filter._visible.value=e,trigger:["click"]},{overlay:n(()=>[Object(r.createVNode)(y,null,{default:n(()=>[t.filter._menus.value.length?(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:0},[(Object(r.openBlock)(!0),Object(r.createBlock)(r.Fragment,null,Object(r.renderList)(t.filter._menus.value,c=>(Object(r.openBlock)(),Object(r.createBlock)(h,{key:c.value},{default:n(()=>[Object(r.createVNode)("div",a,[Object(r.createVNode)(m,{checked:c.checked,"onUpdate:checked":e=>c.checked=e,onChange:r=>e.handleCheckPart(t,o)},{default:n(()=>[Object(r.createTextVNode)(Object(r.toDisplayString)(c.text),1)]),_:2},1032,["checked","onUpdate:checked","onChange"])])]),_:2},1024))),128)),Object(r.createVNode)(h,{class:"footer",divided:""},{default:n(()=>[Object(r.createVNode)("div",i,[Object(r.createVNode)(m,{indeterminate:t.filter.indeterminate.value,checked:t.filter.checkAll.value,"onUpdate:checked":e=>t.filter.checkAll.value=e,onChange:r=>e.handleCheckAll(r,t,o)},{default:n(()=>[s]),_:2},1032,["indeterminate","checked","onUpdate:checked","onChange"]),Object(r.createVNode)(k,{size:"small",type:"primary",onClick:r=>e.filterConfirm(t,o)},{default:n(()=>[Object(r.createTextVNode)(Object(r.toDisplayString)(t.filter.confirmText),1)]),_:2},1032,["onClick"])])]),_:2},1024)],64)):(Object(r.openBlock)(),Object(r.createBlock)(h,{key:1},{default:n(()=>[Object(r.createVNode)("div",u,[d,Object(r.createVNode)(g)])]),_:1}))]),_:2},1024)]),default:n(()=>[Object(r.createVNode)(j,{class:["point",{active:t.filter._default.value}],onClick:Object(r.withModifiers)(e=>t.filter._visible.value=!0,["self"])},null,8,["class","onClick"])]),_:2},1032,["visible","onUpdate:visible"])):Object(r.createCommentVNode)("v-if",!0)])]),default:n(({record:c})=>[t.render?Object(r.renderSlot)(e.$slots,t.render,{key:0,row:c,value:c._values[o]},void 0,!0):(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:1},[c._values[o].text?(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:0},["tag"===t.type?(Object(r.openBlock)(),Object(r.createBlock)(B,{key:0,color:c._values[o].color},{default:n(()=>[Object(r.createTextVNode)(Object(r.toDisplayString)(c._values[o].text),1)]),_:2},1032,["color"])):"ellipsis"===t.type?(Object(r.openBlock)(),Object(r.createBlock)(C,{key:1,text:c._values[o].text},null,8,["text"])):"link"===t.type?(Object(r.openBlock)(),Object(r.createBlock)("a",{key:2,onClick:Object(r.withModifiers)(o=>e.click(c,t),["stop","prevent"])},Object(r.toDisplayString)(c._values[o].text),9,["onClick"])):(Object(r.openBlock)(),Object(r.createBlock)("span",p,Object(r.toDisplayString)(c._values[o].text),1))],2112)):Object(r.createCommentVNode)("v-if",!0),(Object(r.openBlock)(!0),Object(r.createBlock)(r.Fragment,null,Object(r.renderList)(e.validBtns(t.buttons,c,t),o=>(Object(r.openBlock)(),Object(r.createBlock)("span",{key:o.text,class:"mr-md btn"},[o.children.length>0?(Object(r.openBlock)(),Object(r.createBlock)(x,{key:0},{overlay:n(()=>[Object(r.createVNode)(y,null,{default:n(()=>[(Object(r.openBlock)(!0),Object(r.createBlock)(r.Fragment,null,Object(r.renderList)(e.validBtns(o.children,c,t),t=>(Object(r.openBlock)(),Object(r.createBlock)(h,{key:t.text,onClick:o=>e.btnClick(c,t)},{default:n(()=>[Object(r.createVNode)("span",{innerHTML:e.btnText(c._values,t)},null,8,["innerHTML"]),(Object(r.openBlock)(),Object(r.createBlock)(Object(r.resolveDynamicComponent)(t.icon)))]),_:2},1032,["onClick"]))),128))]),_:2},1024)]),default:n(()=>[Object(r.createVNode)("span",b,[Object(r.createVNode)("a",null,[Object(r.createVNode)("span",{innerHTML:e.btnText(c._values,o)},null,8,["innerHTML"]),Object(r.createVNode)(_)])])]),_:2},1024)):(Object(r.openBlock)(),Object(r.createBlock)(r.Fragment,{key:1},["popconfirm"===o.type?(Object(r.openBlock)(),Object(r.createBlock)(w,{key:0,title:o.popconfirm.title,onConfirm:e=>o.popconfirm.confirm(c)},{default:n(()=>[Object(r.createVNode)("a",null,[Object(r.createVNode)("span",{innerHTML:e.btnText(c._values,o)},null,8,["innerHTML"]),(Object(r.openBlock)(),Object(r.createBlock)(Object(r.resolveDynamicComponent)(o.icon)))])]),_:2},1032,["title","onConfirm"])):(Object(r.openBlock)(),Object(r.createBlock)("a",{key:1,onClick:t=>e.btnClick(c,o)},[Object(r.createVNode)("span",{innerHTML:e.btnText(c._values,o)},null,8,["innerHTML"]),(Object(r.openBlock)(),Object(r.createBlock)(Object(r.resolveDynamicComponent)(o.icon)))],8,["onClick"]))],2112))]))),128))],64))]),_:2},1032,["width","customRender","fixed","sorter"]))),128))]),_:2},[e.$slots.expandedRowRender?{name:"expandedRowRender",fn:n(({record:t})=>[Object(r.renderSlot)(e.$slots,"expandedRowRender",{record:t},void 0,!0)])}:void 0]),1032,["onChange","data-source","loading","pagination","rowKey","scroll","bordered"])])});var O=o(1);const v={reName:{total:"total",list:"items"}},j={reName:{pi:"offset",ps:"limit"}},m={front:!0,position:"bottom",show:!0,showSize:!1,pageSizes:[10,20,30,40,50],showQuickJumper:!1,indexReset:!0,toTop:!0,toTopOffset:100},h="确定",k="重置";class g{constructor(){this.lastColumns=[]}process(e){if(this.lastColumns=e,O.ArrayService.arrIsEmpty(e))throw new Error("[st]: the columns property muse be define!");const t=[],o=Object(O.deepCopy)(e);for(const e of o)e.iif&&e.iif(e)||(e.index&&(Array.isArray(e.index)||(e.index=e.index.split(".")),e.indexKey=e.index.join(".")),e.buttons=this.fixButtons(e.buttons),e.width=e.width||"auto",e.default=e.default||"",e.filter=this.filterCoerce(e),t.push(e));return this.fixedCoerce(t),t}filterCoerce(e){if(null==e.filter)return null;const t=e.filter;if((null==t||!t.menus)&&O.ArrayService.arrIsEmpty(null==t?void 0:t.menus))return null;t._menus=Object(r.reactive)({value:[]});return(Array.isArray(t.menus)?()=>Promise.resolve(t.menus):t.menus)().then(e=>{t._menus.value=e}),t.confirmText=t.confirmText||h,t.clearText=t.clearText||k,t.key=t.key||e.indexKey,t._default=Object(r.reactive)({value:!1}),t.indeterminate=Object(r.reactive)({value:!1}),t.checkAll=Object(r.reactive)({value:!1}),t._visible=Object(r.reactive)({value:!1}),t}fixedCoerce(e){const t=(e,t)=>e+ +t.width.toString().replace("px","");e.filter(e=>e.fixed&&"left"===e.fixed&&e.width).forEach((o,r)=>o._left=e.slice(0,r).reduce(t,0)+"px"),e.filter(e=>e.fixed&&"right"===e.fixed&&e.width).reverse().forEach((o,r)=>o._right=(r>0?e.slice(-r).reduce(t,0):0)+"px")}fixButtons(e){if(!e)return[];const t=[];for(const o of e)o.children=O.ArrayService.arrIsEmpty(o.children)?[]:this.fixButtons(o.children),t.push(o);return this.btnCoerceIf(t),t}btnCoerceIf(e){for(const t of e)t.iif||(t.iif=()=>!0),t.iifBehavior=t.iifBehavior||"hide",t.children&&t.children.length>0?this.btnCoerceIf(t.children):t.children=[]}cleanFilter(e){e.filter._menus.value.forEach(e=>e.checked=!1)}checkAllFilter(e,t){t.filter._menus.value.forEach(t=>t.checked=e)}updateDefault(e){e._default.value=-1!==e._menus.value.findIndex(e=>e.checked)}updateIndeterminate(e){const t=e._menus,o=t.value.filter(e=>e.checked).length;e.indeterminate.value=o>0&&o!==t.value.length,e.checkAll.value=o===t.value.length}}var y=o(2);class x{process(e){return new Promise((t,o)=>{const{data:r,res:n,paginator:c,page:l,ps:a,pi:i,columns:s,total:u}=e;let d,p,b,f,v,j=!1,m=l.show;"string"==typeof r?(j=!0,d=this.getByHttp(r,e).then(e=>{let t;var o,r;(v=e,Array.isArray(e))?(t=e,p=t.length,b=p,m=!1):(t=Object(O.deepGet)(e,null==n||null===(o=n.reName)||void 0===o?void 0:o.list,[]),Array.isArray(t)||(t=[]),p=+Object(O.deepGet)(e,null==n||null===(r=n.reName)||void 0===r?void 0:r.total,[])||0);return Object(O.deepCopy)(t)}).catch(e=>(o(e),[]))):d=Array.isArray(r)?Promise.resolve(r):r,j||(d=d.then(e=>(s.filter(e=>e.filter).forEach(t=>{const o=t.filter,r=this.getFilteredData(o);if(0===r.length)return;const n=o.fn;"function"==typeof n?e=e.filter(e=>r.some(t=>n(t,e))):console.warn("[st] Muse provide the fn function in filter")}),e)).then(e=>{if(v=e,c&&l.front){const t=Math.ceil(e.length/a);if(f=Math.max(1,i>t?t:i),p=e.length,l.show)return e.slice((f-1)*a,f*a)}return e})),"function"==typeof n.process&&(d=d.then(e=>n.process(e,v))),d=d.then(e=>{const t=((f||i)-1)*(b||a);for(let o=0,r=e.length;o<r;o++){const r=t+o+1;e[o]._values=s.map((t,n)=>this.get(e[o],t,n,r))}return e}),d.then(e=>{t({pi:f,ps:b,total:p,list:e,pageShow:void 0===m?(p||u)>(b||a):m})})})}get(e,t,o,r){if(t.format){const n=t.format(e,t,o,r);return{text:n||"",org:n}}const n=Object(O.deepGet)(e,t.index,t.default);let c,l=n;switch(t.type){case"tag":{const e=t.tag;if(e&&e[l]){const t=e[l];l=t.text,c=t.color}else l="";break}}return{text:null!=l?l:"",org:n,color:c}}getByHttp(e,t){const{req:o,paginator:r,pi:n,ps:c,columns:l,first:a}=t;let i={};const s=o.reName;return r&&(i={[null==s?void 0:s.pi]:n,[null==s?void 0:s.ps]:c}),i={...i,...o.params,...this.getReqFilterMap(l),...a&&o.firstParams?o.firstParams:{}},y.instance.get(e,{params:i,headers:o.headers})}getFilteredData(e){return e._menus.value.filter(e=>!0===e.checked)}getReqFilterMap(e){let t={};return e.filter(e=>e.filter).forEach(e=>{const o=e.filter,r=this.getFilteredData(o);let n={};o.reName?n=o.reName(o._menus.value,e):n[o.key]=r.map(e=>e.value).join(","),t={...t,...n}}),t}}var B=o(4),C=o(3),_=o(19),w=o.n(_),N=o(6),S=Object(r.defineComponent)({name:"st",props:{columns:Array,pageVo:Object,data:[String,Array,Object],pi:Number,ps:Number,total:Number,res:Object,req:Object,page:Object,rowKey:String,scroll:Object,pagination:{type:Boolean,default:!0},bordered:Boolean},components:{Ellipsis:B.a,LoadingOutlined:C.LoadingOutlined,DownOutlined:C.DownOutlined,EditOutlined:C.EditOutlined,DeleteOutlined:C.DeleteOutlined,FilterOutlined:C.FilterOutlined},setup(e){const t=new g,o=new x,n=Object(r.ref)(!1),c=Object(r.ref)([]),l=Object(r.computed)(()=>Object(O.deepMerge)(e.req||{},j)),a=Object(r.computed)(()=>Object(O.deepMerge)(e.res||{},v)),i=Object(r.computed)(()=>Object(O.deepMerge)(e.res||{},m)),s=Object(r.ref)(e.pi||1),u=Object(r.ref)(e.ps||10),d=Object(r.ref)(e.total||0),p=Object(r.ref)(e.pagination),b=Object(r.ref)([]),[f,h]=Object(O.useRefs)(),k=Object(N.useRouter)(),y=(t=!1)=>{n.value=!0,o.process({pi:s.value,ps:u.value,total:d.value,data:e.data,req:l.value,res:a.value,page:i.value,paginator:!0,columns:c.value,first:t}).then(t=>{n.value=!1,void 0!==t.pi&&(s.value=t.pi),void 0!==t.ps&&(u.value=t.ps),void 0!==t.total&&(d.value=t.total),void 0!==t.pageShow&&e.pagination&&(p.value=t.pageShow),b.value=t.list}).catch(e=>{w.a.error("加载列表失败："+e)})},B=(e,t,o)=>{s.value=e,void 0!==t&&(l.value.params=o&&o.merge?{...l.value.params,...t}:t),y()},C=(e,t)=>{B(1,e,t)},_=e=>{c.value=t.process(e)};Object(r.onMounted)(()=>{_(e.columns),e.data&&y(!0)});const{data:S}=Object(r.toRefs)(e);Object(r.watch)(S,()=>{y()});return{loading:n,columns$:c,data$:b,isPagination:p,total$:d,pi$:s,ps$:u,btnText:(e,t)=>"function"==typeof t.text?t.text(e,t):t.text||"",validBtns:(e,t,o)=>e.filter(e=>{const r=e.iif(t,o),n="disabled"===e.iifBehavior;return e._result=r,e._disabled=!r&&n,r||n}),btnClick:(e,t)=>{if(!t.click)return;"reload"===t.click(e)&&C()},load:B,reload:C,handleCheckAll:(e,o,r)=>{t.checkAllFilter(e.target.checked,o),t.updateIndeterminate(o.filter)},filterConfirm:(e,o)=>{((e,o)=>{e.filter._visible.value=!1,s.value=1,t.updateDefault(e.filter),t.updateIndeterminate(e.filter),y()})(e)},setDropdownRef:h,resetColumns:t=>{void 0!==(t={emitReload:!0,preClearData:!1,...t}).pi&&(s.value=t.pi),void 0!==t.ps&&(u.value=t.ps),t.emitReload&&(t.preClearData=!0),t.preClearData&&(b.value=[]),_(t.columns||e.columns),t.emitReload&&y()},click:(e,t)=>{const o=t.click(e);"string"==typeof o&&k.push(o)},handleCheckPart:(e,o)=>{t.updateIndeterminate(e.filter)},changeTable:e=>{null!=e.current&&B(e.current)},showTotal:e=>`共${e}条`,reloadCurrent:()=>{B(s.value)}}}});o(23),o(24);S.render=f,S.__scopeId="data-v-5894e00e";var T=S;T.install=e=>{e.component(T.name,T)};const V=T;t.default=V}])}));
//# sourceMappingURL=index.js.map